{% extends "base.html" %}

{% block title %}Edit Template - BotForge Pro{% endblock %}

{% block content %}
<div class="landing-page-v2 min-vh-100">
    <div class="container-fluid px-3 py-4">
        <div class="row mb-4">
            <div class="col">
                <a href="{{ url_for('marketplace') }}" class="btn btn-outline-light mb-3">
                    <i class="bi bi-arrow-left"></i> Back to Marketplace
                </a>
                <h2 class="gradient-text display-5 fw-bold"><i class="bi bi-pencil"></i> Edit Template</h2>
                <p class="hero-subtitle">Modify template configuration</p>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-8">
                <form method="POST" action="{{ url_for('edit_template', template_id=template.id) }}">
                    <div class="feature-card mb-4">
                        <h5 class="gradient-text mb-3">Template Metadata</h5>
                        
                        <div class="mb-3">
                            <label for="title" class="form-label text-white">Title</label>
                            <input type="text" class="form-control" id="title" name="title" value="{{ template.title }}" required>
                        </div>

                        <div class="mb-3">
                            <label for="description" class="form-label text-white">Description</label>
                            <textarea class="form-control" id="description" name="description" rows="2" required>{{ template.description }}</textarea>
                        </div>

                        <div class="mb-3">
                            <label for="category" class="form-label text-white">Category</label>
                            <select class="form-control" id="category" name="category" required>
                                <option value="crypto" {% if template.category == 'crypto' %}selected{% endif %}>Crypto</option>
                                <option value="web3" {% if template.category == 'web3' %}selected{% endif %}>Web3</option>
                                <option value="ai" {% if template.category == 'ai' %}selected{% endif %}>AI</option>
                                <option value="marketing" {% if template.category == 'marketing' %}selected{% endif %}>Marketing</option>
                                <option value="webapp" {% if template.category == 'webapp' %}selected{% endif %}>WebApp</option>
                                <option value="game" {% if template.category == 'game' %}selected{% endif %}>Game</option>
                                <option value="mining" {% if template.category == 'mining' %}selected{% endif %}>Mining</option>
                                <option value="custom" {% if template.category == 'custom' %}selected{% endif %}>Custom</option>
                            </select>
                        </div>
                    </div>

                    <div class="feature-card mb-4">
                        <h5 class="gradient-text mb-3">Template JSON Configuration</h5>
                        <p class="text-white-50 mb-3">Edit the template configuration below. Make sure to maintain valid JSON format.</p>
                        
                        <div class="mb-3">
                            <textarea class="form-control" id="template_json" name="template_json" rows="20" style="font-family: monospace; background: #1a1c23; color: #fff; border: 1px solid rgba(255,255,255,0.2);">{{ template_json }}</textarea>
                        </div>

                        <div class="d-flex gap-2">
                            <button type="submit" class="btn btn-primary-gradient">
                                <i class="bi bi-save"></i> Save Changes
                            </button>
                            <button type="button" class="btn btn-outline-light" onclick="validateJSON()">
                                <i class="bi bi-check-circle"></i> Validate JSON
                            </button>
                            <a href="{{ url_for('marketplace') }}" class="btn btn-outline-secondary">
                                <i class="bi bi-x-circle"></i> Cancel
                            </a>
                        </div>
                    </div>
                </form>
            </div>

            <div class="col-lg-4">
                <div class="feature-card sticky-top" style="top: 20px;">
                    <h5 class="gradient-text mb-3">Template Structure</h5>
                    <p class="text-white-50 small">A template should have the following structure:</p>
                    <pre style="background: #1a1c23 !important; color: #fff !important; padding: 15px; border-radius: 8px; font-size: 12px; overflow-x: auto; border: 1px solid rgba(255,255,255,0.1);"><code style="color: #fff !important; background: transparent !important;">{
  "name": "Template Name",
  "description": "Description",
  "category": "crypto",
  "commands": [
    {
      "command": "start",
      "response_type": "text",
      "response_content": "Message",
      "url_link": "optional"
    }
  ],
  "settings": {
    "key": "value"
  }
}</code></pre>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function validateJSON() {
    const jsonText = document.getElementById('template_json').value;
    try {
        JSON.parse(jsonText);
        alert('✓ Valid JSON format!');
    } catch (e) {
        alert('✗ Invalid JSON: ' + e.message);
    }
}
</script>
{% endblock %}
